;(function($) {
    var categories = {
        "1": "建议",
        "2": "其他",
        "3": "投诉",
        "4": "跟踪",
        "5": "赞扬",
        "6": "查询",
        "7": "包装建议",
        "8": "产品建议",
        "9": "渠道投诉",
        "10": "处理赞扬",
        "11": "活动投诉",
        "12": "产品投诉",
        "13": "直接挂机",
        "14": "错话",
        "15": "产品查询",
        "16": "一般性查询",
        "17": "活动查询",
        "18": "跟踪服务",
        "19": "促销建议",
        "20": "活动赞扬",
        "21": "产品赞扬",
        "22": "活动建议",
        "23": "生产制造-产品外观投诉",
        "24": "产品-安全性查询",
        "25": "活动-会员管理",
        "26": "变更投诉",
        "27": "促销建议-促销礼品",
        "28": "生产制造-粘扣投诉（仅限好奇、得伴）",
        "29": "跟踪服务-反馈购买信息",
        "30": "产品建议-一般性",
        "31": "生产制造-气味投诉",
        "32": "产品建议-新品类/新用途",
        "33": "活动-兑换礼品",
        "34": "产品-一般性查询",
        "35": "生产制造-腰部松紧带/区域投诉（仅限好奇、得伴）",
        "36": "生产制造-综合投诉",
        "37": "生产制造-杂质投诉",
        "38": "活动建议-积分查询",
        "39": "一般性-合作商联系方式",
        "40": "产品-真伪查询",
        "41": "活动建议-活动规则",
        "42": "生产制造-感觉投诉",
        "43": "产品-产品组分/原料查询",
        "44": "产品-包装查询",
        "45": "活动建议-忘记密码",
        "46": "生产制造-防漏隔边松紧带/区域投诉（仅限好奇、得伴））",
        "47": "生产制造-松紧边投诉（仅限高洁丝））",
        "48": "广告投诉",
        "49": "赞扬-包装设计",
        "50": "跟踪服务-反馈产品信息",
        "51": "跟踪服务-需要联系经销商",
        "52": "渠道-包装问题",
        "53": "生产制造-掉色投诉",
        "54": "生产制造-吸收性投诉",
        "55": "生产制造-湿度投诉（仅限湿巾/湿厕纸）",
        "56": "生产制造-底膜投诉",
        "57": "安全性投诉",
        "58": "活动-积分查询",
        "59": "活动-活动规则",
        "60": "跟踪服务-反馈银行账号信息",
        "61": "赞扬-产品",
        "62": "促销建议-促销价格",
        "63": "包装建议-包装环保",
        "64": "活动-忘记密码",
        "65": "一般性-公司信息",
        "66": "生产制造-腿部松紧带/区域投诉（仅限好奇、得伴）",
        "67": "渠道-产品问题",
        "68": "产品建议-薄厚",
        "69": "生产制造-尿裤图案投诉（仅限好奇、得伴）",
        "70": "一般性-经销产品",
        "71": "跟踪服务-反馈消费者信息",
        "72": "产品建议-香味",
        "73": "生产制造-包装投诉",
        "74": "赞扬-广告",
        "75": "生产制造-尿裤耳部投诉（仅限好奇、得伴）",
        "76": "生产制造-吸收体投诉",
        "77": "处理-综合赞扬",
        "78": "跟踪服务-需要联系婴店",
        "79": "赞扬-活动",
        "80": "产品建议-规格尺寸",
        "81": "活动-一般性",
        "82": "一般性-综合",
        "83": "产品建议-干湿程度",
        "84": "包装建议-包装材料",
        "85": "活动建议-一般性",
        "86": "促销建议-促销渠道",
        "87": "产品-护理知识查询",
        "88": "活动建议-兑换礼品",
        "89": "活动-更换邮寄地址",
        "90": "生产制造-导流层投诉（仅限高洁丝）",
        "91": "生产制造-离型纸投诉（仅限高洁丝）",
        "92": "活动建议-更换邮寄地址",
        "93": "产品建议-印刷",
        "94": "活动-礼品兑换",
        "95": "跟踪服务-需要联系销售",
        "96": "产品-价格查询",
        "97": "活动-综合投诉",
        "98": "设计投诉",
        "99": "包装建议-一般性",
        "100": "促销建议-一般性",
        "101": "包装建议-包装印刷图案",
        "102": "生产制造-过敏投诉",
        "103": "生产制造-纸投诉（仅限舒洁）",
        "104": "赞扬-综合",
        "105": "跟踪服务-处理进度查询",
        "106": "生产制造-尿湿显示（仅限好奇）",
        "107": "生产制造-胶投诉",
        "108": "跟踪服务-需要联系消费者",
        "109": "促销建议-促销时间",
        "110": "包装建议-包装打开方式",
        "111": "一般性-购买产品",
        "112": "生产制造-加香/添加剂投诉",
        "113": "生产制造-缺件投诉",
        "114": "礼品-积分兑换要求不合理",
        "115": "礼品-一般性",
        "116": "变更-购买产品与图片不符（新老产品交替）",
        "117": "安全性-甲基异噻唑啉酮(MIT)",
        "118": "吸收性-用后皮肤潮湿",
        "119": "粘扣-重新粘合能力-一般性",
        "120": "产品-尿显问题",
        "121": "广告-太少",
        "122": "杂质-死昆虫",
        "123": "离型纸-移动",
        "124": "粘扣-完全无粘性",
        "125": "粘扣-两边不对称",
        "126": "吸收性-渗漏-边缘/中间裆部",
        "127": "会员-不能注册/登陆",
        "128": "缺件-弹性腰围/松紧带一根或多根缺失",
        "129": "粘扣-重新粘合能力-不能粘合",
        "130": "缺件-离型纸",
        "131": "赞扬-吸收性",
        "132": "粘扣-太粘/将底膜粘破",
        "133": "腰部松紧带-一般性",
        "134": "产品-粘扣问题",
        "135": "杂质-活昆虫",
        "136": "加香-过多",
        "137": "包装-条形码丢失",
        "138": "吸收体-结团断层-使用后",
        "139": "胶-一般性",
        "140": "气味-药味",
        "141": "礼品-积分录入错误",
        "142": "吸收体-开封-两端",
        "143": "外观-粘结在一起",
        "144": "过敏-一般性",
        "145": "纸-末端被裹住",
        "146": "加香-不足",
        "147": "变更-型号/尺寸变更问题",
        "148": "广告-内容",
        "149": "纸-首端被裹住",
        "150": "胶-位置",
        "151": "杂质-木片",
        "152": "气味-化学药品/石油味/油墨味",
        "153": "安全性-其他化学物质",
        "154": "腿部松紧带-没有松紧性或不合适",
        "155": "添加剂-不足",
        "156": "图案-掀起/分开",
        "157": "纸-卷纸错层",
        "158": "包装-小袋没密封",
        "159": "尿裤耳部-太硬/锋利",
        "160": "图案-粘贴的不合适",
        "161": "感觉-小",
        "162": "礼品-供应不足",
        "163": "安全性-荧光增白剂",
        "164": "腰部松紧-便便防漏兜",
        "165": "外观-缺少压花",
        "166": "吸收性-不均匀",
        "167": "尿裤耳部-一般性",
        "168": "防漏隔边-太紧",
        "169": "添加剂-过多",
        "170": "赞扬-无刺激性",
        "171": "变更-包装变更",
        "172": "过敏-红屁屁",
        "173": "缺件-高分子吸水树脂",
        "174": "气味-香水味",
        "175": "外观-侧面不齐",
        "176": "包装-开封/未封口",
        "177": "腰部松紧带-太紧",
        "178": "防漏隔边-末端封口胶丢失/位置错误",
        "179": "松紧边-太硬/粗糙（妇女护理用品专用",
        "180": "缺件-导流层",
        "181": "外观-一般性",
        "182": "包装-小袋太空",
        "183": "产品-气味问题",
        "184": "产品渗漏问题",
        "185": "吸收性-用后反渗",
        "186": "气味-发霉味",
        "187": "防漏隔边-完整性",
        "188": "安全性-一般性",
        "189": "外观-内部外露",
        "190": "包装-盖子问题",
        "191": "会员-一般性",
        "192": "缺件-底膜",
        "193": "过敏-灼痛感",
        "194": "松紧边-扯掉（妇女护理用品专用）",
        "195": "吸收体-硬块",
        "196": "杂质-染料/油墨",
        "197": "吸收体-高分子吸水树脂泄露",
        "198": "杂质-接头/有颜色胶带",
        "199": "包装-尺寸/产品错误/内外不符",
        "200": "粘扣-产品在粘扣处撕破",
        "201": "掉色-产品",
        "202": "赞扬-产品环保",
        "203": "离型纸-位置",
        "204": "礼品-代金券/验证码无法使用或过期",
        "205": "外观-没有型号",
        "206": "包装-数量错误/缺数",
        "207": "纸-一般性",
        "208": "气味-樟脑味",
        "209": "导流层-完整性",
        "210": "湿度-过湿",
        "211": "尿裤耳部-多余的耳部",
        "212": "防漏隔边-一般性",
        "213": "粘扣-太硬/锋利",
        "214": "防漏隔边-尺寸",
        "215": "杂质-硬币/钱币",
        "216": "湿度-一般性",
        "217": "感觉-不透气",
        "218": "掉色-一般性",
        "219": "感觉-一般性",
        "220": "松紧边-没有（妇女护理用品专用）",
        "221": "杂质-锋利物",
        "222": "缺件-防漏折叶/松紧带一根或多根缺失",
        "223": "防漏隔边-松紧带胶丢失/位置错误",
        "224": "包装-缺数问题",
        "225": "底膜-不透气",
        "226": "尿湿显示-使用后不变色",
        "227": "感觉-软",
        "228": "吸收体-一般性",
        "229": "赞扬-方便性",
        "230": "粘扣-使用后粘性不足",
        "231": "纸-多层重叠/连抽",
        "232": "感觉-滑腻的/油腻的",
        "233": "包装-无生产日期及批号",
        "234": "纸-纸层间太松",
        "235": "吸收体-纤维起绒球",
        "236": "纸-粘在一起",
        "237": "礼品-积分兑换流程复杂/不方便",
        "238": "缺件-腿部松紧/松紧带一根或多根缺失",
        "239": "缺件-内层无纺布",
        "240": "过敏-刺眼",
        "241": "尿湿显示-缺失",
        "242": "感觉-薄",
        "243": "尿裤耳部-难打开",
        "244": "包装-独立包装有声响",
        "245": "腰部松紧带-打褶/外翻",
        "246": "杂质-一般性",
        "247": "气味-烟味",
        "248": "腿部松紧带-与底膜粘结",
        "249": "包装-产品与包装/独立包装粘连",
        "250": "气味-鱼腥味",
        "251": "赞扬-感觉",
        "252": "产品-吸水性问题",
        "253": "礼品-长时间收不到礼品",
        "254": "变更-产品升级后没有升级前好",
        "255": "杂质-赃物/油脂/油",
        "256": "赞扬-情节性",
        "257": "导流层-一般性",
        "258": "外观-颜色问题",
        "259": "感觉-硬",
        "260": "导流层-粗糙",
        "261": "广告-一般性",
        "262": "赞扬-产品设计",
        "263": "气味-一般性",
        "264": "杂质-受潮长霉斑",
        "265": "过敏-刺鼻/刺激喉咙",
        "266": "尿裤耳部-损坏",
        "267": "图案-损坏",
        "268": "广告-太多",
        "269": "缺件-耳状部位",
        "270": "包装-包装文字有错误",
        "271": "防漏隔边-损坏",
        "272": "赞扬-产品价格",
        "273": "杂质-软衬料/边角料",
        "274": "变更-一般性",
        "275": "外观-切割不好",
        "276": "吸收体-开封-边部/侧面/其他处",
        "277": "综合投诉",
        "278": "会员-频繁收到活动邮件/短信",
        "279": "包装-产品混淆",
        "280": "广告-虚假宣传/扩大宣传",
        "281": "包装-破损/太次/产品损坏",
        "282": "气味-塑料/橡胶味",
        "283": "杂质-毛发",
        "284": "气味-尿味",
        "285": "包装-存留过多空气",
        "286": "导流层-丢失/固定性不好",
        "287": "感觉-大",
        "288": "赞扬-安全性",
        "289": "吸收性-吸收太慢",
        "290": "安全性-防腐剂",
        "291": "感觉-潮湿的",
        "292": "感觉-粗糙的",
        "293": "粘扣-位置",
        "294": "腰部松紧带-太硬/锋利",
        "295": "吸收体-用后表层有果冻状颗粒",
        "296": "掉色-硬纸箱/包装盒",
        "297": "纸-不易抽取",
        "298": "纸-抽出时纸撕裂",
        "299": "腿部松紧带-太紧",
        "300": "产品-抽检不合格问题",
        "301": "包装-积分丢失",
        "302": "感觉-厚",
        "303": "防漏隔边-表层粘在一起",
        "304": "吸收性-渗漏-末端",
        "305": "外观-发光/闪光",
        "306": "粘扣-和尿裤粘在一起/和包装粘在一起",
        "307": "包装-印刷不好",
        "308": "粘扣-一般性",
        "309": "变更-新老版产品混装",
        "310": "包装-密封不好/开封",
        "311": "礼品-邮寄礼品周期太长",
        "312": "气味-酸味/恶臭味",
        "313": "纸-卷芯破损",
        "314": "安全性-酒精",
        "315": "腿部松紧带-一般性",
        "316": "吸收体-破损",
        "317": "缺件-胶",
        "318": "纸-不吸收",
        "319": "感觉-黏乎乎的",
        "320": "添加剂-一般性",
        "321": "纸-掉毛脱屑",
        "322": "吸收体-高分子吸水树脂分布不均匀",
        "323": "图案-一般性",
        "324": "湿度-不足",
        "325": "产品-媒体问题",
        "326": "杂质-汤汁/粘液点",
        "327": "包装-不易关闭",
        "328": "胶-过多",
        "329": "离型纸-一般性",
        "330": "吸收体-结团断层-使用前",
        "331": "粘扣-破损/断开",
        "332": "纸-不禁用/一擦就破",
        "333": "过敏-起水泡/脱皮",
        "334": "过敏-阴道问题",
        "335": "尿湿显示-使用前变色",
        "336": "胶-不足",
        "337": "纸-末端散开",
        "338": "赞扬-质量",
        "339": "安全性-丙二醇",
        "340": "缺件-一般性",
        "341": "底膜-底膜起毛/脱落",
        "342": "产品-过敏问题",
        "343": "防漏隔边-太硬/粗糙",
        "344": "尿湿显示-一般性",
        "345": "包装-包装破损",
        "346": "吸收体-挤压/扭曲",
        "347": "纸-间距线丢失或不好",
        "348": "缺件-吸收体",
        "349": "过敏-红印",
        "350": "礼品-兑换时间不合理",
        "351": "礼品-与宣传资料不符",
        "352": "感觉-勒腿",
        "353": "吸收性-一般性",
        "354": "包装-没有透气孔/撕裂线",
        "355": "会员-不能及时反馈密码",
        "356": "吸收性-渗漏-前端",
        "357": "粘扣-已揭开",
        "358": "防漏隔边-不合适",
        "359": "离型纸-不易撕掉/撕不下来",
        "360": "吸收性-弄脏衣物",
        "361": "设计-包装设计",
        "362": "吸收性-底膜渗漏",
        "363": "杂质-黑色绒毛",
        "364": "腿部松紧带-失效/太松",
        "365": "赞扬-环保",
        "366": "底膜-一般性",
        "367": "松紧边-位置（妇女护理用品专用）",
        "368": "包装-不易打开",
        "369": "尿湿显示-使用后晕染",
        "370": "包装-一般性",
        "371": "底膜-用后潮湿有水分",
        "372": "过敏-典型皮疹",
        "373": "缺件-粘扣/一侧或两侧缺失",
        "374": "外观-产品不正确的折叠",
        "375": "防漏隔边-失效/太松",
        "376": "外观-折叠/褶皱",
        "377": "腰部松紧带-失效/太松",
        "378": "腰部松紧带-没有松紧性或不合适",
        "379": "包装-漏液",
        "380": "腰部松紧带-粘结在一起",
        "381": "杂质-塑料",
        "382": "杂质-胶残留",
        "383": "底膜-破损",
        "384": "会员-收不到活动邮件/短信",
        "385": "礼品-礼品错误",
        "386": "松紧边-一般性（妇女护理用品专用）",
        "387": "变更-一次性购买产品既有老版又有新版",
        "388": "产品问题-一般性",
        "389": "礼品-礼品质量问题",
        "390": "活动-综合性",
        "391": "感觉-没有上一次购买的产品好",
        "392": "包装-小袋丢失",
        "393": "粘扣-废料",
        "394": "杂质-烧焦物/熔化物",
        "395": "设计-产品设计",
        "396": "加香-一般性"
    };

    var relations = {
        "x": "1,2,3,4,5,6", // 第一级比较特殊,设置为x，仅前端需要
        "1": "7,8,19,22",
        "2": "14,13",
        "3": "9,11,12",
        "4": "18",
        "5": "10,20,21",
        "6": "15,17,16",
        "7": "84,99,63,101,110",
        "8": "72,83,30,32,93,80,68",
        "9": "52,67",
        "10": "77",
        "11": "25,94,97",
        "12": "23,26,73,28,31,76,75,36,35,37,42,90,47,46,91,48,98,53,54,102,103,55,106,107,57,56,113,112,66,69",
        "15": "24,40,87,43,44,34,96",
        "16": "39,82,111,65,70",
        "17": "58,59,89,64,33,81",
        "18": "71,108,29,60,95,78,50,105,51",
        "19": "27,86,109,100,62",
        "20": "79",
        "21": "74,61,49,104",
        "22": "41,85,88,45,92,38",
        "23": "258,181,305,175,374,143,165,205,189,275,376",
        "25": "127,278,355,384,191",
        "26": "387,171,116,274,309,254,147",
        "73": "233,182,281,270,379,206,301,137,368,285,190,158,370,244,307,354,392,327,199,249,310",
        "28": "132,119,124,125,306,308,393,213,357,230,293,200,129,331",
        "31": "250,140,282,186,174,152,284,247,263,208,312",
        "76": "276,346,235,322,195,142,197,228,316,330,295,138",
        "75": "243,167,159,266,211",
        "36": "277",
        "35": "164,378,133,380,245,294,377,177",
        "37": "135,363,273,151,382,283,381,255,122,221,196,326,198,246,264,394,215",
        "42": "217,219,302,161,319,242,287,259,352,391,227,291,292,232",
        "90": "286,260,209,257",
        "47": "194,179,367,386,220",
        "46": "223,271,212,187,358,168,343,375,214,303,178",
        "91": "203,359,329,123",
        "48": "268,148,261,280,121",
        "94": "114,162,141,115,350,351,389,204,237,253,385,311",
        "97": "390",
        "52": "224,176,279,370,345",
        "98": "361,395",
        "53": "201,296,218",
        "54": "126,304,362,289,185,353,356,166,118,360",
        "102": "193,334,333,349,172,372,144,265,240",
        "103": "234,297,298,236,149,337,207,157,318,347,321,145,231,313,332",
        "55": "216,324,210",
        "106": "241,335,226,369,344",
        "107": "336,150,328,139",
        "57": "314,163,153,117,290,339,188",
        "56": "371,225,366,383,341",
        "61": "202,170,131,288,272,251,365,338,262,229,256",
        "113": "269,173,238,340,239,317,192,222,348,128,373,130,180",
        "112": "320,136,155,169,146,396",
        "67": "388,183,134,184,252,325,300,342,120",
        "66": "315,299,364,154,248",
        "69": "323,156,160,267"
    };

    var $body = $('body'),
        func_category_wrap = '.category-chain-wrap',
        func_category_item = func_category_wrap + ' > select';

    $body.on('change', func_category_item, function() {
        var $this = $(this),
            $next = $this.next('select'),
            pId = $this.val();

        $this.nextAll('select').html('');

        if (!pId || !$next.length) return;

        setOpts($next, pId);
    });

    /**
     * 用法：
     * 1、在类别级联select的父级必须有class="category-chain-wrap"
     *    例如： <p class="category-chain-wrap"><select></select><select></select><select></select></p>
     * 2、如有初始化值，id使用-连接，在.category-chain-wrap标签上增加属性 data-init-ids="1-12-33-55"
     * 3、最后执行initCategoryChain()， 完成。
     * @return {[type]} [description]
     */
    function initCategoryChain() {
        // 初始化
        $body.find(func_category_wrap).each(function() {
            var initIds = $(this).data('init-ids')
            ,   $select = $(this).children()
            ,   $first = $select.eq(0)
            ,   ids;

            setOpts($first, 'x');

            // 有默认选中项则处理，否则直接退出
            if (!initIds) return;

            ids = initIds.split('-');

            $select.each(function (index) {
                var id = ids[index];
                id && $(this).val(id).trigger('change');
            });
        });
    }
    /**
     * 根据id获取对应的名称
     * @param  {[type]} cid 类别id
     * @return {[type]} 返回类别名称
     */
    function getNameById(cid) {
        return categories[cid];
    }
    /**
     * 对外暴露可用方法
     */
    window.initCategoryChain = initCategoryChain;
    window.getNameById = getNameById;

    /**
     * 内部生成option选项的方法
     * @param {[type]} $select    下拉对象
     * @param {[type]} pid        父级id
     * @param {[type]} selectedId 默认选中值id
     * @param {[type]} defaultOpt 空值时候的默认选项
     */
    function setOpts($select, pid, selectedId, defaultOpt) {
        // 根据所传父级id，获取到下一级的选项id列表
        var ids = relations[pid];

        if (!ids) {
            $select.html('<option value="n">-</option>');
            return;
        }

        var optsId = ids.split(','),
            i = 0,
            l = optsId.length,
            optsHTML = defaultOpt || '<option value="">请选择</option>',
            id;

        for (; i < l; i++) {
            id = optsId[i];
            optsHTML += '<option' + (selectedId == id ? ' selected' : '') + ' value="' + id + '">' + categories[id] + '</option>';
        }

        $select.html(optsHTML);
    }

})(jQuery);